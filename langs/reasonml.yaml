id: "reasonml"
aliases:
  - "re"
  - "reason"
  - "bsc"
  - "buckle"
  - "bucklescript"
name: "ReasonML"

install:
  prepare:
    apt:
      - yarn
    npm:
      - bs-platform
  npm:
    - bs-platform
  opam:
    - name: reason
      binaries:
        - refmt
  manual: |
    install -d "${pkg}/opt/reasonml/skel"
    install -d "${pkg}/usr/local/bin"

    ver="$(latest_release jaredly/reason-language-server)"
    wget "https://github.com/jaredly/reason-language-server/releases/download/${ver}/rls-linux.zip"
    unzip rls-linux.zip
    cp rls-linux/reason-language-server "${pkg}/usr/local/bin/"

    pushd "${pkg}/opt/reasonml/skel"
    bsb -init .
    cat bsconfig.json | jq '.name = "riju-project"' | sponge bsconfig.json
    yarn install
    popd

main: "main.re"
template: |
  print_string("Hello, world!\n");

compile: |
  bsc main.re > main.js
run: |
  NODE_PATH=/usr/lib/node_modules node main.js

format:
  run: |
    refmt
  input: |
    print_string("Hello, world!\n")

lsp:
  setup: |
    cp -a /opt/reasonml/skel/* ./
  start: |
    reason-language-server

skip:
  - lsp
